var socket=io(),isMouseDown=!1,data={},color="#00ff00",size=3;$(document).ready(function(){function o(o){a.beginPath(),a.fillStyle=o.c,a.fillRect(o.x-o.s/2,o.y-o.s/2,o.s,o.s),a.closePath()}function n(){socket.emit("draw",JSON.stringify(data)),data={}}var e=document.getElementById("canvas"),a=e.getContext("2d");socket.emit("getCanvas","Load"),$("#color").change(function(){var o=/^[A-Fa-f0-9]+$/,n=$("#color").val();null==o.exec(n)?(color="#ffffff",$("#color").css({"background-color":"#aa2222"})):(color="#"+n,$("#color").css({"background-color":color,color:"#FFFFFF"}))}),$("#size").change(function(){size=$("#size").val()}),$("#download").click(function(){socket.emit("getCanvas","Download")}),e.addEventListener("mousedown",function(){isMouseDown=!0}),e.addEventListener("mouseup",function(){isMouseDown=!1}),e.addEventListener("mousemove",function(e){if(isMouseDown){var a={x:e.offsetX,y:e.offsetY,c:color,s:size};data[Date.now()]=a,o(a),n()}}),socket.on("receive",function(n){var e=JSON.parse(n);for(var a in e)o(e[a])}),socket.on("setCanvas",function(o){console.log("setting canvas"),$("#canvas").css({"background-image":"url("+o+")"})}),socket.on("downloadCanvas",function(o){var n=document.createElement("a");n.href=o,n.download="download.png",n.click()})});